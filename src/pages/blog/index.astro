---
import { getCollection } from "astro:content";
import BaseHead from "@/components/BaseHead.astro";
import Footer from "@/components/Footer.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import Header from "@/components/Header.astro";
import { SITE_TITLE } from "@/consts";

const posts = (
	await getCollection("blog", ({ data }) => {
		// In production, filter out drafts. In dev, show all posts.
		return import.meta.env.PROD ? data.draft !== true : true;
	})
).sort((a, b) => {
	const dateA = a.data.date || a.data.pubDate;
	const dateB = b.data.date || b.data.pubDate;
	return dateB!.valueOf() - dateA!.valueOf();
});
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead
			title={`Blog - ${SITE_TITLE}`}
			description="Thoughts on creative technology, innovation, and building the future."
		/>
	</head>
	<body>
		<Header />

		<main class="blog-main">
			<div class="blog-container">
				<div class="section-header">
					<span class="section-marker">>></span>
					<h1 class="section-title">SYSTEM_LOGS</h1>
				</div>

				{
					posts.length === 0 ? (
						<p class="no-posts">
							[SYSTEM_MSG]: No logs found in the archives.
						</p>
					) : (
						<ul class="posts-list">
							{posts.map((post) => (
								<li class="post-item">
									<a href={`/blog/${post.id}/`} class="post-link">
										<time class="post-date">
											<FormattedDate
												date={
													(post.data.date ||
														post.data.pubDate)!
												}
											/>
										</time>
										<span class="post-separator">â†’</span>
										<span class="post-title">{post.data.title}</span>
										{post.data.draft && (
											<span class="draft-badge">[DRAFT]</span>
										)}
									</a>
								</li>
							))}
						</ul>
					)
				}
			</div>
		</main>

		<Footer />

		<style>
			.blog-main {
				max-width: 1000px;
				margin: 0 auto;
				padding: 4rem 2rem;
				min-height: 70vh;
			}

			.section-header {
				display: flex;
				align-items: center;
				gap: 1rem;
				margin-bottom: 3rem;
				border-bottom: 1px solid var(--border-color);
				padding-bottom: 0.5rem;
			}

			.section-marker {
				color: var(--accent-active);
				font-family: 'JetBrains Mono', monospace;
				font-weight: 700;
			}

			.section-title {
				font-family: 'JetBrains Mono', monospace;
				font-size: 2rem;
				font-weight: 700;
				color: var(--text-primary);
				margin: 0;
				letter-spacing: -0.05em;
			}

			.no-posts {
				color: var(--text-secondary);
				font-family: 'JetBrains Mono', monospace;
				text-align: center;
				padding: 2rem;
				border: 1px dashed var(--border-color);
			}

			.posts-list {
				list-style: none;
				padding: 0;
				margin: 0;
				display: flex;
				flex-direction: column;
				gap: 0.5rem;
			}

			.post-item {
				border-bottom: 1px solid var(--border-color);
				transition: border-color 0.2s ease;
			}

			.post-item:last-child {
				border-bottom: none;
			}

			.post-item:hover {
				border-color: var(--accent-active);
			}

			.post-link {
				display: flex;
				align-items: baseline;
				gap: 1rem;
				padding: 0.75rem 0;
				text-decoration: none;
				color: var(--text-primary);
				font-family: 'JetBrains Mono', monospace;
				font-size: 0.95rem;
				transition: all 0.2s ease;
			}

			.post-link:hover {
				color: var(--accent-active);
				transform: translateX(4px);
			}

			.post-date {
				color: var(--text-muted);
				font-size: 0.85rem;
				min-width: 100px;
				flex-shrink: 0;
			}

			.post-separator {
				color: var(--accent-active);
				flex-shrink: 0;
			}

			.post-title {
				color: inherit;
				flex: 1;
			}

			.draft-badge {
				color: var(--text-muted);
				font-size: 0.75rem;
				margin-left: 0.5rem;
				flex-shrink: 0;
			}

			@media (max-width: 768px) {
				.blog-main {
					padding: 2rem 1rem;
				}

				.post-title {
					font-size: 1.25rem;
				}
			}
		</style>
	</body>
</html>
