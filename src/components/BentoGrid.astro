---
import { Image } from "astro:assets";
import Icon from "./Icon.astro";
import { getLatestBlogPost, formatDate } from "@/utils/blog";

interface Props {
	mePhoto: ImageMetadata;
	nowStatus: string;
}

const { mePhoto, nowStatus } = Astro.props;

const techStack = [
	{ name: "Rust", icon: "mdi:language-rust", color: "#dea584" },
	{ name: "Python", icon: "mdi:language-python", color: "#3776ab" },
	{ name: "AWS", icon: "mdi:aws", color: "#ff9900" },
	{ name: "Kubernetes", icon: "mdi:kubernetes", color: "#326ce5" },
	{ name: "Zig", icon: "mdi:flash", color: "#ec915c" },
	{ name: "PostgreSQL", icon: "mdi:database", color: "#336791" },
];

const interests = [
	{ name: "Systems Design", icon: "mdi:database-cog" },
	{ name: "Photography", icon: "mdi:camera" },
	{ name: "Boxing", icon: "mdi:dumbbell" },
	{ name: "Open Source", icon: "mdi:github" },
];

const openTo = [
	{ name: "Consulting", icon: "mdi:briefcase" },
	{ name: "Speaking", icon: "mdi:microphone" },
	{ name: "Collaborations", icon: "mdi:handshake" },
];

const latestPost = await getLatestBlogPost();
---

<section class="bento-grid">
    <!-- Profile Module -->
    <div class="bento-item profile-card">
        <div class="profile-header">
            <div class="avatar-container">
                <Image
                    src={mePhoto}
                    alt="Adrian Villanueva"
                    class="avatar"
                    width={80}
                    height={80}
                />
                <div class="status-indicator"></div>
            </div>
            <div class="profile-info">
                <h1 class="name">Adrian Villanueva</h1>
                <p class="role">Senior Systems Engineer</p>
                <div class="location">
                    <Icon name="mdi:map-marker" size={14} />
                    <span>Tokyo, JP</span>
                </div>
            </div>
        </div>
        <p class="bio">
            Building resilient cloud-native data platforms. Focused on
            simplicity, scalability, and developer experience.
        </p>
        <div class="social-links">
            <a
                href="https://github.com/adrianvillanueva997"
                target="_blank"
                aria-label="GitHub"
            >
                <Icon name="mdi:github" size={20} />
            </a>
            <a
                href="https://linkedin.com/in/adrian-villanueva-martinez"
                target="_blank"
                aria-label="LinkedIn"
            >
                <Icon name="mdi:linkedin" size={20} />
            </a>
            <a
                href="mailto:adrian.villanueva.martinez@outlook.com"
                aria-label="Email"
            >
                <Icon name="mdi:email" size={20} />
            </a>
        </div>
    </div>

    <!-- Status Monitor (NOW) -->
    <div class="bento-item status-monitor">
        <div class="module-header">
            <Icon name="mdi:pulse" size={16} class="text-active" />
            <span class="module-title">SYSTEM STATUS</span>
        </div>
        <div class="status-content">
            <div class="status-item">
                <span class="label">FOCUS</span>
                <span class="value">{nowStatus}</span>
            </div>
            <div class="status-item">
                <span class="label">LOCATION</span>
                <span class="value">Tokyo, Japan</span>
            </div>
            <div class="status-item">
                <span class="label">UPTIME</span>
                <span class="value uptime-value">
                    <span id="uptime-counter">Initializing...</span><span class="cursor">_</span>
                </span>
            </div>
        </div>
        <a href="/about" class="status-link">View Full Report &rarr;</a>
    </div>

    <!-- Latest Blog Post -->
    {latestPost && (
        <div class="bento-item latest-blog">
            <div class="module-header">
                <Icon name="mdi:pencil" size={16} />
                <span class="module-title">LATEST POST</span>
            </div>
            <div class="blog-content">
                <a href={latestPost.link} target="_blank" rel="noopener noreferrer" class="blog-link">
                    <h3 class="blog-title">{latestPost.title}</h3>
                </a>
                {latestPost.pubDate && (
                    <span class="blog-date">{formatDate(latestPost.pubDate)}</span>
                )}
                <a href={latestPost.link} target="_blank" rel="noopener noreferrer" class="read-more">Read on metalops.dev &rarr;</a>
            </div>
        </div>
    )}

<script>
    function updateUptime() {
        // System start date (Birth date: Jan 1, 1997)
        const start = new Date('1997-01-01T00:00:00');
        const now = new Date();
        const diff = now.getTime() - start.getTime();

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        const element = document.getElementById('uptime-counter');
        if (element) {
            element.innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }
    }

    setInterval(updateUptime, 1000);
    updateUptime();
</script>


    <!-- Tech Stack -->
    <div class="bento-item tech-stack">
        <div class="module-header">
            <Icon name="mdi:chip" size={16} />
            <span class="module-title">CORE MODULES</span>
        </div>
        <div class="tech-grid">
            {
                techStack.map((tech) => (
                    <div class="tech-item">
                        <Icon name={tech.icon} size={20} />
                        <span>{tech.name}</span>
                    </div>
                ))
            }
        </div>
    </div>

    <!-- Interests -->
    <div class="bento-item interests">
        <div class="module-header">
            <Icon name="mdi:heart" size={16} />
            <span class="module-title">INTERESTS</span>
        </div>
        <div class="interests-list">
            {
                interests.map((interest) => (
                    <div class="interest-item">
                        <Icon name={interest.icon} size={18} />
                        <span>{interest.name}</span>
                    </div>
                ))
            }
        </div>
    </div>

    <!-- Open To -->
    <div class="bento-item open-to">
        <div class="module-header">
            <Icon name="mdi:star" size={16} class="text-active" />
            <span class="module-title">OPEN TO</span>
        </div>
        <div class="open-to-list">
            {
                openTo.map((item) => (
                    <div class="open-to-item">
                        <Icon name={item.icon} size={18} />
                        <span>{item.name}</span>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<style>
    .bento-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, auto);
        gap: 1.5rem;
        margin: 2rem 0 4rem 0;
    }

    .bento-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
    }

    .bento-item:hover {
        border-color: var(--border-light);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* Profile Card - Spans 1x2 */
    .profile-card {
        grid-column: span 1;
        grid-row: span 2;
        justify-content: flex-start;
    }

    .profile-header {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        align-items: center;
        text-align: center;
    }

    .avatar {
        border-radius: 50%;
        border: 2px solid var(--border-color);
        transition: transform 0.3s ease;
        width: 64px;
        height: 64px;
    }

    .bento-item:hover .avatar {
        transform: scale(1.05);
    }

    .avatar-container {
        position: relative;
    }

    .status-indicator {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 12px;
        height: 12px;
        background-color: var(--accent-active);
        border-radius: 50%;
        border: 2px solid var(--bg-secondary);
        box-shadow: 0 0 8px var(--accent-active);
    }

    .profile-info {
        width: 100%;
    }

    .name {
        font-size: 1.1rem;
        margin: 0 0 0.2rem 0;
        line-height: 1.2;
    }

    .role {
        color: var(--accent-active);
        font-size: 0.75rem;
        margin-bottom: 0.4rem;
        font-weight: 500;
        letter-spacing: 0.05em;
    }

    .location {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
        font-size: 0.7rem;
        color: var(--text-muted);
        font-family: 'JetBrains Mono', monospace;
    }

    .bio {
        margin: 1rem 0 0.75rem 0;
        font-size: 0.8rem;
        color: var(--text-secondary);
        line-height: 1.4;
    }

    .social-links {
        display: flex;
        gap: 0.75rem;
        justify-content: center;
    }

    .social-links a {
        color: var(--text-muted);
        transition: color 0.2s ease;
    }

    .social-links a:hover {
        color: var(--accent-active);
    }

    /* Status Monitor - Spans 2x1 */
    .status-monitor {
        grid-column: span 2;
    }

    .module-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.75rem;
        color: var(--text-muted);
        letter-spacing: 0.05em;
    }

    .text-active {
        color: var(--accent-active);
    }

    .status-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .status-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .label {
        font-size: 0.7rem;
        color: var(--text-muted);
        font-family: 'JetBrains Mono', monospace;
        text-transform: uppercase;
    }

    .value {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-primary);
    }

    .uptime-value {
        font-family: 'JetBrains Mono', monospace;
        color: var(--accent-active);
    }

    .cursor {
        display: inline-block;
        width: 8px;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }

    .status-link {
        margin-top: auto;
        font-size: 0.8rem;
        color: var(--accent-active);
        text-align: right;
    }

    /* Latest Blog Post - Spans 1x1 */
    .latest-blog {
        grid-column: span 1;
    }

    .blog-content {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
    }

    .blog-link {
        text-decoration: none;
        color: inherit;
    }

    .blog-title {
        margin: 0;
        font-size: 0.95rem;
        border: none;
        padding: 0;
        line-height: 1.3;
        color: var(--text-primary);
        font-weight: 600;
        transition: color 0.2s ease;
    }

    .blog-link:hover .blog-title {
        color: var(--accent-active);
    }

    .blog-date {
        font-size: 0.7rem;
        color: var(--text-muted);
        font-family: 'JetBrains Mono', monospace;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .read-more {
        margin-top: auto;
        font-size: 0.75rem;
        color: var(--accent-active);
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .read-more:hover {
        color: var(--text-primary);
    }

    /* Tech Stack - Spans 1x1 */
    .tech-stack {
        grid-column: span 1;
    }

    .tech-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
    }

    .tech-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-family: 'JetBrains Mono', monospace;
    }

    /* Interests - Spans 1x1 */
    .interests {
        grid-column: span 1;
    }

    .interests-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .interest-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-family: 'JetBrains Mono', monospace;
    }

    /* Open To - Spans 1x1 */
    .open-to {
        grid-column: span 1;
    }

    .open-to-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .open-to-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-family: 'JetBrains Mono', monospace;
    }

    /* Latest Blog Post - Spans 1x1 */
    .latest-blog {
        grid-column: span 1;
    }

    .blog-content {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
    }

    .blog-link {
        text-decoration: none;
        color: inherit;
    }

    .blog-title {
        margin: 0;
        font-size: 0.95rem;
        border: none;
        padding: 0;
        line-height: 1.3;
        color: var(--text-primary);
        font-weight: 600;
        transition: color 0.2s ease;
    }

    .blog-link:hover .blog-title {
        color: var(--accent-active);
    }

    .blog-date {
        font-size: 0.7rem;
        color: var(--text-muted);
        font-family: 'JetBrains Mono', monospace;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .read-more {
        margin-top: auto;
        font-size: 0.75rem;
        color: var(--accent-active);
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .read-more:hover {
        color: var(--text-primary);
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .bento-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .profile-card {
            grid-column: span 2;
        }

        .status-monitor {
            grid-column: span 2;
        }
    }

    @media (max-width: 640px) {
        .bento-grid {
            display: flex;
            flex-direction: column;
        }
    }
</style>
