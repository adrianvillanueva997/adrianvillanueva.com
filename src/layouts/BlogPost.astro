---
import BaseHead from '@/components/BaseHead.astro';
import Footer from '@/components/Footer.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Header from '@/components/Header.astro';
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';

type Props = CollectionEntry<'blog'>['data'];

const {
	title,
	description,
	summary,
	date,
	pubDate,
	updatedDate,
	heroImage,
	tags,
	draft,
} = Astro.props;

// Use new 'date' field, fallback to 'pubDate' for backwards compatibility
const postDate = date || pubDate;
const postDescription = summary || description;
---

<html lang="en">
	<head>
		<BaseHead
			title={title}
			description={postDescription}
			article={{
				publishedTime: postDate?.toISOString(),
				modifiedTime: updatedDate?.toISOString(),
				author: 'Adrian Villanueva Martinez',
				tags: tags,
			}}
		/>
		<style>
			.blog-container {
				max-width: 780px;
				margin: 0 auto;
				padding: 3rem 2rem;
			}

			/* Back link */
			.back-link {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				color: var(--text-muted);
				text-decoration: none;
				font-size: 0.875rem;
				margin-bottom: 4rem;
				transition: all 0.2s ease;
				font-family: 'Courier New', monospace;
				letter-spacing: 0.02em;
			}

			.back-link:hover {
				color: var(--accent-cyan);
				transform: translateX(-4px);
			}

			.back-link::before {
				content: '←';
				transition: transform 0.2s ease;
			}

			/* Draft banner */
			.draft-banner {
				background: rgba(220, 20, 60, 0.1);
				border: 3px solid var(--accent-crimson);
				padding: 1rem 1.5rem;
				margin-bottom: 2rem;
				border-radius: 4px;
				display: flex;
				align-items: center;
				gap: 1rem;
				box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);
				animation: pulse-draft 2s ease-in-out infinite;
			}

			@keyframes pulse-draft {
				0%,
				100% {
					box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);
				}
				50% {
					box-shadow: 0 0 30px rgba(220, 20, 60, 0.6);
				}
			}

			.draft-icon {
				font-size: 1.5rem;
				line-height: 1;
			}

			.draft-text {
				color: var(--text-primary);
				font-family: 'Courier New', monospace;
				font-size: 0.9375rem;
				line-height: 1.5;
			}

			.draft-text strong {
				color: var(--accent-crimson);
				font-weight: 900;
				font-family: 'Orbitron', monospace;
				letter-spacing: 0.1em;
			}

			/* Header section */
			.post-header {
				margin-bottom: 4rem;
				padding-bottom: 2.5rem;
				border-bottom: 2px solid var(--bg-tertiary);
			}

			.blog-title {
				font-size: clamp(2.25rem, 6vw, 3.5rem);
				font-weight: 800;
				color: var(--text-primary);
				margin-bottom: 1.5rem;
				line-height: 1.15;
				letter-spacing: -0.03em;
				font-family: 'Orbitron', monospace;
			}

			.description {
				font-size: 1.25rem;
				color: var(--text-secondary);
				line-height: 1.6;
				margin-bottom: 1.5rem;
				font-weight: 400;
			}

			.blog-meta {
				display: flex;
				align-items: center;
				gap: 1rem;
				flex-wrap: wrap;
				font-size: 0.875rem;
				margin-bottom: 0.5rem;
			}

			.date {
				color: var(--text-muted);
				font-family: 'Courier New', monospace;
				letter-spacing: 0.02em;
			}

			.updated-date {
				color: var(--text-muted);
				font-family: 'Courier New', monospace;
				letter-spacing: 0.02em;
			}

			.updated-date::before {
				content: '•';
				margin-right: 1rem;
				color: var(--text-muted);
			}

			.reading-time {
				color: var(--text-muted);
				font-family: 'Courier New', monospace;
				letter-spacing: 0.02em;
			}

			.reading-time::before {
				content: '•';
				margin-right: 1rem;
				color: var(--text-muted);
			}

			/* Tags styling */
			.tags-container {
				display: flex;
				gap: 0.625rem;
				flex-wrap: wrap;
				margin-top: 1.25rem;
			}

			.tag {
				display: inline-block;
				padding: 0.375rem 0.875rem;
				background: var(--bg-secondary);
				border: 1px solid var(--accent-cyan);
				color: var(--accent-cyan);
				font-size: 0.8125rem;
				font-family: 'Courier New', monospace;
				text-decoration: none;
				transition: all 0.2s ease;
				letter-spacing: 0.02em;
			}

			.tag:hover {
				background: var(--accent-cyan);
				color: var(--bg-primary);
				transform: translateY(-2px);
				box-shadow: 0 4px 8px var(--accent-cyan-glow);
			}

			.tag::before {
				content: '#';
				opacity: 0.7;
				margin-right: 0.125rem;
			}

			/* Hero image */
			.hero-image {
				width: 100%;
				margin-bottom: 3rem;
				border: 2px solid var(--bg-tertiary);
				overflow: hidden;
				transition: border-color 0.3s ease;
			}

			.hero-image:hover {
				border-color: var(--accent-cyan);
			}

			.hero-image img {
				width: 100%;
				height: auto;
				display: block;
				transition: transform 0.3s ease;
			}

			.hero-image:hover img {
				transform: scale(1.02);
			}

			/* Article content */
			.prose {
				line-height: 1.85;
				color: var(--text-secondary);
				font-size: 1.125rem;
				font-family: 'Inter', sans-serif;
			}

			.prose > * + * {
				margin-top: 1.75rem;
			}

			/* First paragraph - make it stand out */
			.prose > p:first-of-type {
				font-size: 1.25rem;
				line-height: 1.75;
				color: var(--text-primary);
				margin-bottom: 2rem;
			}

			.prose h1,
			.prose h2,
			.prose h3,
			.prose h4,
			.prose h5,
			.prose h6 {
				color: var(--text-primary);
				margin-top: 3rem;
				margin-bottom: 1.25rem;
				line-height: 1.3;
				font-weight: 700;
				font-family: 'Orbitron', monospace;
				letter-spacing: -0.02em;
			}

			.prose h1 {
				font-size: 2.25rem;
				margin-top: 4rem;
			}

			.prose h2 {
				font-size: 1.875rem;
				padding-bottom: 0.625rem;
				border-bottom: 2px solid var(--bg-tertiary);
				position: relative;
			}

			.prose h2::after {
				content: '';
				position: absolute;
				bottom: -2px;
				left: 0;
				width: 60px;
				height: 2px;
				background: var(--accent-cyan);
			}

			.prose h3 {
				font-size: 1.5rem;
				color: var(--accent-cyan);
			}

			.prose h4 {
				font-size: 1.25rem;
			}

			.prose p {
				margin: 1.75rem 0;
				line-height: 1.85;
			}

			.prose a {
				color: var(--accent-cyan);
				text-decoration: none;
				border-bottom: 1px solid var(--accent-cyan);
				transition: all 0.2s ease;
				font-weight: 500;
			}

			.prose a:hover {
				color: var(--text-primary);
				border-bottom-color: var(--text-primary);
				text-shadow: 0 0 8px var(--accent-cyan-glow);
			}

			.prose strong {
				color: var(--text-primary);
				font-weight: 700;
			}

			.prose em {
				font-style: italic;
				color: var(--text-secondary);
			}

			.prose code {
				background: var(--bg-secondary);
				color: var(--accent-cyan);
				padding: 0.25em 0.5em;
				border-radius: 4px;
				font-size: 0.9em;
				font-family: 'Courier New', monospace;
				border: 1px solid var(--bg-tertiary);
			}

			.prose pre {
				background: var(--bg-secondary);
				border: 2px solid var(--bg-tertiary);
				padding: 1.75rem;
				overflow-x: auto;
				border-radius: 6px;
				margin: 2.5rem 0;
				position: relative;
			}

			.prose pre code {
				background: none;
				padding: 0;
				border-radius: 0;
				font-size: 0.9375rem;
				line-height: 1.6;
				border: none;
			}

			.prose blockquote {
				border-left: 4px solid var(--accent-cyan);
				padding-left: 1.75rem;
				margin: 2.5rem 0;
				font-style: italic;
				color: var(--text-primary);
				background: var(--bg-secondary);
				padding: 1.5rem 1.75rem;
				border-radius: 0 4px 4px 0;
			}

			.prose blockquote p {
				margin: 0;
			}

			.prose ul,
			.prose ol {
				margin: 2rem 0;
				padding-left: 2rem;
			}

			.prose li {
				margin-bottom: 1rem;
				color: var(--text-secondary);
				line-height: 1.8;
			}

			.prose li::marker {
				color: var(--accent-cyan);
				font-weight: 700;
			}

			.prose li > ul,
			.prose li > ol {
				margin-top: 0.75rem;
				margin-bottom: 0.75rem;
			}

			.prose hr {
				border: none;
				border-top: 2px solid var(--bg-tertiary);
				margin: 4rem 0;
				position: relative;
			}

			.prose hr::after {
				content: '◆';
				position: absolute;
				top: -12px;
				left: 50%;
				transform: translateX(-50%);
				background: var(--bg-primary);
				padding: 0 1rem;
				color: var(--accent-cyan);
			}

			.prose img {
				max-width: 100%; /* Allow natural sizing but constrain to container */
				height: auto;
				border: 2px solid var(--bg-tertiary);
				margin: 2.5rem auto; /* Center images */
				display: block; /* Makes centering work */
				border-radius: 4px;
				transition: border-color 0.3s ease;
			}

			.prose img:hover {
				border-color: var(--accent-cyan);
			}

			/* SVG images (d2 diagrams) - disable global filters */
			.prose img[src$='.svg'] {
				filter: none !important;
				background: white;
				padding: 1.5rem;
				border: 2px solid var(--accent-cyan);
			}

			.prose img[src$='.svg']:hover {
				box-shadow: none; /* Disable brutal shadow for diagrams */
			}

			.prose table {
				width: 100%;
				border-collapse: collapse;
				margin: 2.5rem 0;
				font-size: 0.95rem;
			}

			.prose th,
			.prose td {
				border: 1px solid var(--bg-tertiary);
				padding: 1rem;
				text-align: left;
			}

			.prose th {
				background: var(--bg-secondary);
				color: var(--text-primary);
				font-weight: 700;
				font-family: 'Courier New', monospace;
				text-transform: uppercase;
				font-size: 0.85rem;
				letter-spacing: 0.05em;
			}

			.prose td {
				background: var(--bg-primary);
			}

			.prose tr:hover td {
				background: var(--bg-secondary);
			}

			/* Responsive */
			@media (max-width: 768px) {
				.blog-container {
					padding: 2rem 1.25rem;
				}

				.back-link {
					margin-bottom: 3rem;
					font-size: 0.8125rem;
				}

				.post-header {
					margin-bottom: 3rem;
					padding-bottom: 2rem;
				}

				.blog-title {
					font-size: 2rem;
					line-height: 1.2;
				}

				.description {
					font-size: 1.125rem;
				}

				.blog-meta {
					flex-direction: column;
					align-items: flex-start;
					gap: 0.5rem;
				}

				.updated-date::before,
				.reading-time::before {
					content: '';
					margin-right: 0;
				}

				.prose {
					font-size: 1.0625rem;
				}

				.prose > p:first-of-type {
					font-size: 1.125rem;
				}

				.prose h1 {
					font-size: 1.875rem;
					margin-top: 3rem;
				}

				.prose h2 {
					font-size: 1.5rem;
				}

				.prose h3 {
					font-size: 1.25rem;
				}

				.prose pre {
					padding: 1.25rem;
					margin: 2rem -1.25rem;
					border-radius: 0;
					border-left: none;
					border-right: none;
				}

				.prose blockquote {
					padding: 1.25rem 1.5rem;
					margin: 2rem -1.25rem;
					border-radius: 0;
				}

				.prose ul,
				.prose ol {
					padding-left: 1.5rem;
				}
			}

			@media (max-width: 480px) {
				.blog-container {
					padding: 1.5rem 1rem;
				}

				.blog-title {
					font-size: 1.75rem;
				}

				.description {
					font-size: 1rem;
				}

				.prose {
					font-size: 1rem;
				}

				.prose > p:first-of-type {
					font-size: 1.0625rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<article class="blog-container">
				<a href="/blog" class="back-link">Back to Blog</a>

				<header class="post-header">
					{
						draft && (
							<div class="draft-banner">
								<span class="draft-icon">⚠️</span>
								<span class="draft-text">
									This is a <strong>DRAFT</strong> post and
									may not be finalized
								</span>
							</div>
						)
					}
					<h1 class="blog-title">{title}</h1>
					{
						postDescription && (
							<p class="description">{postDescription}</p>
						)
					}
					<div class="blog-meta">
						{
							postDate && (
								<time
									class="date"
									datetime={postDate.toISOString()}
								>
									<FormattedDate date={postDate} />
								</time>
							)
						}
						{
							updatedDate && (
								<time
									class="updated-date"
									datetime={updatedDate.toISOString()}
								>
									Updated <FormattedDate date={updatedDate} />
								</time>
							)
						}
					</div>
					{
						tags && tags.length > 0 && (
							<div class="tags-container">
								{tags.map((tag) => (
									<span class="tag">{tag}</span>
								))}
							</div>
						)
					}
				</header>

				{
					heroImage && (
						<div class="hero-image">
							<Image
								width={720}
								height={405}
								src={heroImage}
								alt={title}
							/>
						</div>
					)
				}

				<div class="prose">
					<slot />
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
